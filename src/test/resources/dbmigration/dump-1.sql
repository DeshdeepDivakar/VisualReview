-- Database dump of a db-version 1 schema. Used to test db migrations.
-- This dump consists of:
-- - project with name: 'db-migration-project'
-- - ..containing a suite with name: 'suite1'
-- - ..containing runs with screenshots 'First', 'Second', 'Third'
-- - in run with ID 1:
-- - First is accepted, Second rejected, Third still idle. All have no diffs
-- - in run with ID 2:
-- - First is auto-accepted (no difference)
-- - Second is accepted, Third rejected
-- - in run with ID 3:
-- - First is auto-accepted (no difference)
-- - Second is accepted (against a diff of 24.7 %)
-- - Third is accepted (no diff because no baseline yet)
--
-- The baseline of suite1 should be comprised of:
-- - First from run 1
-- - Second of run 3
-- - Third of run 3

;
CREATE USER IF NOT EXISTS "" SALT '' HASH '' ADMIN;            
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_AD53648E_53CD_4983_B508_9FB457491526 START WITH 2 BELONGS_TO_TABLE;     
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_D814004A_3502_45F0_B96F_1E300A31F781 START WITH 4 BELONGS_TO_TABLE;     
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_EA32EAE5_C240_412B_AD28_1ACF1EB12B4F START WITH 10 BELONGS_TO_TABLE;    
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_601A354C_5DC6_4013_9736_611B817DB35E START WITH 2 BELONGS_TO_TABLE;     
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_87A23325_8DE8_4C1A_9002_CA719D6F3DF8 START WITH 2 BELONGS_TO_TABLE;     
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_F4107B7B_2637_4C13_9C25_AAF6E6D4E9C2 START WITH 2 BELONGS_TO_TABLE;     
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_1ACB8DE7_1F6F_4A28_B359_0313195B4C48 START WITH 19 BELONGS_TO_TABLE;    
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_EB31E190_CF2E_42C9_B7F0_13D8F9EC0C9F START WITH 4 BELONGS_TO_TABLE;     
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_23C8AFC9_E0E3_43DB_934D_D201EDF435CF START WITH 10 BELONGS_TO_TABLE;    
CREATE CACHED TABLE PUBLIC.IMAGE(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_1ACB8DE7_1F6F_4A28_B359_0313195B4C48) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_1ACB8DE7_1F6F_4A28_B359_0313195B4C48,
    DIRECTORY VARCHAR(250) NOT NULL
);     
ALTER TABLE PUBLIC.IMAGE ADD CONSTRAINT PUBLIC.CONSTRAINT_4 PRIMARY KEY(ID);   
-- 18 +/- SELECT COUNT(*) FROM PUBLIC.IMAGE;   
INSERT INTO PUBLIC.IMAGE(ID, DIRECTORY) VALUES
(1, '2015/8/9/21'),
(2, '2015/8/9/21'),
(3, '2015/8/9/21'),
(4, '2015/8/9/21'),
(5, '2015/8/9/21'),
(6, '2015/8/9/21'),
(7, '2015/8/9/21'),
(8, '2015/8/9/21'),
(9, '2015/8/9/21'),
(10, '2015/8/9/21'),
(11, '2015/8/9/21'),
(12, '2015/8/9/21'),
(13, '2015/8/9/21'),
(14, '2015/8/9/21'),
(15, '2015/8/9/21'),
(16, '2015/8/9/21'),
(17, '2015/8/9/21'),
(18, '2015/8/9/22');
CREATE CACHED TABLE PUBLIC.PROJECT(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_87A23325_8DE8_4C1A_9002_CA719D6F3DF8) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_87A23325_8DE8_4C1A_9002_CA719D6F3DF8,
    NAME VARCHAR NOT NULL
);             
ALTER TABLE PUBLIC.PROJECT ADD CONSTRAINT PUBLIC.CONSTRAINT_1 PRIMARY KEY(ID); 
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.PROJECT;  
INSERT INTO PUBLIC.PROJECT(ID, NAME) VALUES
(1, 'db-migration-project');       
CREATE CACHED TABLE PUBLIC.SUITE(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_601A354C_5DC6_4013_9736_611B817DB35E) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_601A354C_5DC6_4013_9736_611B817DB35E,
    PROJECT_ID INTEGER NOT NULL,
    NAME VARCHAR NOT NULL
);              
ALTER TABLE PUBLIC.SUITE ADD CONSTRAINT PUBLIC.CONSTRAINT_4B PRIMARY KEY(ID);  
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.SUITE;    
INSERT INTO PUBLIC.SUITE(ID, PROJECT_ID, NAME) VALUES
(1, 1, 'suite1');        
CREATE CACHED TABLE PUBLIC.BASELINE_NODE(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_F4107B7B_2637_4C13_9C25_AAF6E6D4E9C2) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_F4107B7B_2637_4C13_9C25_AAF6E6D4E9C2,
    PARENT BIGINT
);               
ALTER TABLE PUBLIC.BASELINE_NODE ADD CONSTRAINT PUBLIC.CONSTRAINT_C PRIMARY KEY(ID);           
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.BASELINE_NODE;            
INSERT INTO PUBLIC.BASELINE_NODE(ID, PARENT) VALUES
(1, NULL); 
CREATE CACHED TABLE PUBLIC.BASELINE_TREE(
    ID INTEGER DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_AD53648E_53CD_4983_B508_9FB457491526) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_AD53648E_53CD_4983_B508_9FB457491526,
    SUITE_ID BIGINT NOT NULL,
    BASELINE_ROOT BIGINT NOT NULL
);
ALTER TABLE PUBLIC.BASELINE_TREE ADD CONSTRAINT PUBLIC.CONSTRAINT_CCA PRIMARY KEY(ID);         
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.BASELINE_TREE;            
INSERT INTO PUBLIC.BASELINE_TREE(ID, SUITE_ID, BASELINE_ROOT) VALUES
(1, 1, 1);
CREATE CACHED TABLE PUBLIC.BASELINE_BRANCH(
    NAME VARCHAR(32) NOT NULL,
    BASELINE_TREE INTEGER NOT NULL,
    BRANCH_ROOT BIGINT NOT NULL,
    HEAD BIGINT NOT NULL
);    
ALTER TABLE PUBLIC.BASELINE_BRANCH ADD CONSTRAINT PUBLIC.CONSTRAINT_B5198 PRIMARY KEY(BASELINE_TREE, NAME);    
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.BASELINE_BRANCH;          
INSERT INTO PUBLIC.BASELINE_BRANCH(NAME, BASELINE_TREE, BRANCH_ROOT, HEAD) VALUES
('master', 1, 1, 1);         
CREATE UNIQUE INDEX PUBLIC.BRANCH_HEAD ON PUBLIC.BASELINE_BRANCH(HEAD);        
CREATE CACHED TABLE PUBLIC.RUN(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_EB31E190_CF2E_42C9_B7F0_13D8F9EC0C9F) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_EB31E190_CF2E_42C9_B7F0_13D8F9EC0C9F,
    SUITE_ID INTEGER,
    BRANCH_NAME VARCHAR(32),
    START_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
    END_TIME TIMESTAMP,
    STATUS VARCHAR(31) NOT NULL
);          
ALTER TABLE PUBLIC.RUN ADD CONSTRAINT PUBLIC.CONSTRAINT_13 PRIMARY KEY(ID);    
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.RUN;      
INSERT INTO PUBLIC.RUN(ID, SUITE_ID, BRANCH_NAME, START_TIME, END_TIME, STATUS) VALUES
(1, 1, 'master', TIMESTAMP '2015-09-09 21:05:43.027', NULL, 'running'),
(2, 1, 'master', TIMESTAMP '2015-09-09 21:08:00.296', NULL, 'running'),
(3, 1, 'master', TIMESTAMP '2015-09-09 21:09:51.999', NULL, 'running'); 
CREATE CACHED TABLE PUBLIC.SCREENSHOT(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_23C8AFC9_E0E3_43DB_934D_D201EDF435CF) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_23C8AFC9_E0E3_43DB_934D_D201EDF435CF,
    SIZE INTEGER NOT NULL,
    PROPERTIES VARCHAR(512) NOT NULL,
    META VARCHAR(512) NOT NULL,
    SCREENSHOT_NAME VARCHAR NOT NULL,
    RUN_ID INTEGER NOT NULL,
    IMAGE_ID BIGINT
);            
ALTER TABLE PUBLIC.SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_41 PRIMARY KEY(ID);             
-- 9 +/- SELECT COUNT(*) FROM PUBLIC.SCREENSHOT;               
INSERT INTO PUBLIC.SCREENSHOT(ID, SIZE, PROPERTIES, META, SCREENSHOT_NAME, RUN_ID, IMAGE_ID) VALUES
(1, 27552, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'First', 1, 1),
(2, 30490, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'Second', 1, 3),
(3, 19984, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'Third', 1, 5),
(4, 27552, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'First', 2, 7),
(5, 30490, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'Second', 2, 9),
(6, 19984, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'Third', 2, 11),
(7, 27552, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'First', 3, 13),
(8, 30696, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'Second', 3, 15),
(9, 19984, '{"os":"MAC","browser":"firefox","version":"40.0.3","resolution":"800x877"}', '{}', 'Third', 3, 17);              
CREATE CACHED TABLE PUBLIC.BL_NODE_SCREENSHOT(
    BASELINE_NODE BIGINT NOT NULL,
    SCREENSHOT_ID BIGINT NOT NULL
);         
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.BL_NODE_SCREENSHOT;       
INSERT INTO PUBLIC.BL_NODE_SCREENSHOT(BASELINE_NODE, SCREENSHOT_ID) VALUES
(1, 7),
(1, 8),
(1, 9);             
CREATE CACHED TABLE PUBLIC.ANALYSIS(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_D814004A_3502_45F0_B96F_1E300A31F781) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_D814004A_3502_45F0_B96F_1E300A31F781,
    CREATION_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP() NOT NULL,
    RUN_ID INTEGER NOT NULL,
    BASELINE_NODE INTEGER NOT NULL
);    
ALTER TABLE PUBLIC.ANALYSIS ADD CONSTRAINT PUBLIC.CONSTRAINT_F PRIMARY KEY(ID);
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.ANALYSIS; 
INSERT INTO PUBLIC.ANALYSIS(ID, CREATION_TIME, RUN_ID, BASELINE_NODE) VALUES
(1, TIMESTAMP '2015-09-09 21:05:43.033', 1, 1),
(2, TIMESTAMP '2015-09-09 21:08:00.297', 2, 1),
(3, TIMESTAMP '2015-09-09 21:09:52.0', 3, 1);     
CREATE CACHED TABLE PUBLIC.DIFF(
    ID BIGINT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_EA32EAE5_C240_412B_AD28_1ACF1EB12B4F) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_EA32EAE5_C240_412B_AD28_1ACF1EB12B4F,
    BEFORE INTEGER,
    AFTER INTEGER NOT NULL,
    PERCENTAGE NUMERIC(5, 2) NOT NULL,
    IMAGE_ID BIGINT,
    STATUS VARCHAR(8) NOT NULL,
    ANALYSIS_ID INTEGER NOT NULL
);             
ALTER TABLE PUBLIC.DIFF ADD CONSTRAINT PUBLIC.CONSTRAINT_2 PRIMARY KEY(ID);    
-- 9 +/- SELECT COUNT(*) FROM PUBLIC.DIFF;     
INSERT INTO PUBLIC.DIFF(ID, BEFORE, AFTER, PERCENTAGE, IMAGE_ID, STATUS, ANALYSIS_ID) VALUES
(1, NULL, 1, 0.00, 2, 'accepted', 1),
(2, NULL, 2, 0.00, 4, 'rejected', 1),
(3, NULL, 3, 0.00, 6, 'pending', 1),
(4, 1, 4, 0.00, 8, 'accepted', 2),
(5, NULL, 5, 0.00, 10, 'accepted', 2),
(6, NULL, 6, 0.00, 12, 'rejected', 2),
(7, 4, 7, 0.00, 14, 'accepted', 3),
(8, 5, 8, 24.70, 16, 'accepted', 3),
(9, NULL, 9, 0.00, 18, 'accepted', 3); 
ALTER TABLE PUBLIC.BASELINE_NODE ADD CONSTRAINT PUBLIC.CONSTRAINT_CC9 CHECK(ID <> PARENT) NOCHECK;             
ALTER TABLE PUBLIC.DIFF ADD CONSTRAINT PUBLIC.CONSTRAINT_2004 UNIQUE(IMAGE_ID);
ALTER TABLE PUBLIC.ANALYSIS ADD CONSTRAINT PUBLIC.CONSTRAINT_F1 UNIQUE(RUN_ID);
ALTER TABLE PUBLIC.SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_417716 UNIQUE(RUN_ID, SCREENSHOT_NAME, PROPERTIES);             
ALTER TABLE PUBLIC.SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_4177 UNIQUE(IMAGE_ID);          
ALTER TABLE PUBLIC.PROJECT ADD CONSTRAINT PUBLIC.CONSTRAINT_18 UNIQUE(NAME);   
ALTER TABLE PUBLIC.BASELINE_TREE ADD CONSTRAINT PUBLIC.CONSTRAINT_CCA171 UNIQUE(BASELINE_ROOT);
ALTER TABLE PUBLIC.BASELINE_BRANCH ADD CONSTRAINT PUBLIC.CONSTRAINT_B51 UNIQUE(HEAD);          
ALTER TABLE PUBLIC.BL_NODE_SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_1C1C UNIQUE(BASELINE_NODE, SCREENSHOT_ID);              
ALTER TABLE PUBLIC.BASELINE_TREE ADD CONSTRAINT PUBLIC.CONSTRAINT_CCA1 UNIQUE(SUITE_ID);       
ALTER TABLE PUBLIC.SUITE ADD CONSTRAINT PUBLIC.CONSTRAINT_4B95 UNIQUE(PROJECT_ID, NAME);       
ALTER TABLE PUBLIC.BASELINE_TREE ADD CONSTRAINT PUBLIC.CONSTRAINT_CCA1715 FOREIGN KEY(BASELINE_ROOT) REFERENCES PUBLIC.BASELINE_NODE(ID) ON DELETE CASCADE NOCHECK;            
ALTER TABLE PUBLIC.DIFF ADD CONSTRAINT PUBLIC.CONSTRAINT_200 FOREIGN KEY(AFTER) REFERENCES PUBLIC.SCREENSHOT(ID) ON DELETE CASCADE NOCHECK;    
ALTER TABLE PUBLIC.ANALYSIS ADD CONSTRAINT PUBLIC.CONSTRAINT_F19 FOREIGN KEY(RUN_ID) REFERENCES PUBLIC.RUN(ID) ON DELETE CASCADE NOCHECK;      
ALTER TABLE PUBLIC.BASELINE_BRANCH ADD CONSTRAINT PUBLIC.CONSTRAINT_B519 FOREIGN KEY(HEAD) REFERENCES PUBLIC.BASELINE_NODE(ID) NOCHECK;        
ALTER TABLE PUBLIC.DIFF ADD CONSTRAINT PUBLIC.CONSTRAINT_20 FOREIGN KEY(BEFORE) REFERENCES PUBLIC.SCREENSHOT(ID) ON DELETE CASCADE NOCHECK;    
ALTER TABLE PUBLIC.BASELINE_NODE ADD CONSTRAINT PUBLIC.CONSTRAINT_CC FOREIGN KEY(PARENT) REFERENCES PUBLIC.BASELINE_NODE(ID) NOCHECK;          
ALTER TABLE PUBLIC.RUN ADD CONSTRAINT PUBLIC.CONSTRAINT_13E FOREIGN KEY(SUITE_ID, BRANCH_NAME) REFERENCES PUBLIC.BASELINE_BRANCH(BASELINE_TREE, NAME) ON DELETE CASCADE NOCHECK;               
ALTER TABLE PUBLIC.SUITE ADD CONSTRAINT PUBLIC.CONSTRAINT_4B9 FOREIGN KEY(PROJECT_ID) REFERENCES PUBLIC.PROJECT(ID) ON DELETE CASCADE NOCHECK; 
ALTER TABLE PUBLIC.DIFF ADD CONSTRAINT PUBLIC.CONSTRAINT_20040 FOREIGN KEY(IMAGE_ID) REFERENCES PUBLIC.IMAGE(ID) NOCHECK;      
ALTER TABLE PUBLIC.ANALYSIS ADD CONSTRAINT PUBLIC.CONSTRAINT_F196 FOREIGN KEY(BASELINE_NODE) REFERENCES PUBLIC.BASELINE_NODE(ID) ON DELETE CASCADE NOCHECK;    
ALTER TABLE PUBLIC.BASELINE_BRANCH ADD CONSTRAINT PUBLIC.CONSTRAINT_B FOREIGN KEY(BASELINE_TREE) REFERENCES PUBLIC.BASELINE_TREE(ID) ON DELETE CASCADE NOCHECK;
ALTER TABLE PUBLIC.BASELINE_TREE ADD CONSTRAINT PUBLIC.CONSTRAINT_CCA17 FOREIGN KEY(SUITE_ID) REFERENCES PUBLIC.SUITE(ID) ON DELETE CASCADE NOCHECK;           
ALTER TABLE PUBLIC.SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_41771 FOREIGN KEY(IMAGE_ID) REFERENCES PUBLIC.IMAGE(ID) NOCHECK;
ALTER TABLE PUBLIC.BASELINE_BRANCH ADD CONSTRAINT PUBLIC.CONSTRAINT_B5 FOREIGN KEY(BRANCH_ROOT) REFERENCES PUBLIC.BASELINE_NODE(ID) NOCHECK;   
ALTER TABLE PUBLIC.BL_NODE_SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_1C1 FOREIGN KEY(SCREENSHOT_ID) REFERENCES PUBLIC.SCREENSHOT(ID) ON DELETE CASCADE NOCHECK;              
ALTER TABLE PUBLIC.SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_417 FOREIGN KEY(RUN_ID) REFERENCES PUBLIC.RUN(ID) ON DELETE CASCADE NOCHECK;    
ALTER TABLE PUBLIC.DIFF ADD CONSTRAINT PUBLIC.CONSTRAINT_200405_0 FOREIGN KEY(ANALYSIS_ID) REFERENCES PUBLIC.ANALYSIS(ID) ON DELETE CASCADE NOCHECK;           
ALTER TABLE PUBLIC.BL_NODE_SCREENSHOT ADD CONSTRAINT PUBLIC.CONSTRAINT_1C FOREIGN KEY(BASELINE_NODE) REFERENCES PUBLIC.BASELINE_NODE(ID) ON DELETE CASCADE NOCHECK;            
